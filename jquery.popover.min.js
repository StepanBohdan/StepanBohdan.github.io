var myo=function(i,o,e){function t(){u=$('<div class="popover-container" id="popover-container"></div>').appendTo("body"),h=$('<div class="popover-dim"></div>').appendTo(u),h.on("click",c.close),$(o).on("keydown",function(i){27===i.keyCode&&p&&c.close()}),v=!0}function n(){return h.length?void h.css("display","block").stop().animate({opacity:.5},100):!1}function l(){return h.length?void h.stop().animate({opacity:0},100,function(){h.css("display","none")}):!1}function r(){var e,t,n,l;e=Math.max(o.documentElement.scrollLeft,o.body.scrollLeft),n=o.documentElement.clientWidth,o.documentElement.style.overflow="visible",o.body.style.overflow="hidden",l=o.documentElement.clientWidth-n,t=Math.max(o.documentElement.scrollLeft,o.body.scrollLeft),a=e-t,o.body.style.borderRight=l+"px solid transparent",i.scrollBy(e-t,0),o.body.scrollLeft+=1,o.body.scrollLeft+=-1}function s(){o.documentElement.style.overflow="",o.body.style.overflow="",o.body.style.borderRight="",i.scrollBy(a,0)}var a,c,d=$(i),m=[],v=!1,p=!1,u=null,h=null;return c={open:function(i){var o=new PopoverWin(i);v||t(),p||n(),m.length&&c.winLast().disable(),m.push(o),o.scrollDiv.appendTo(u),1===m.length&&r(),o.open(),p=!0},close:function(i){m.length&&(c.winLast().close(),m.pop()),m.length?c.winLast().enable():(l(),p=!1,s())},winLast:function(){return m[m.length-1]},winFirst:function(){return m[0]},win:function(i){return m[i]}},PopoverWin=function(i){this.options=i||{},this.scrollDiv,this.wrapDiv,this.bodyDiv,this.loadDiv,this.closDiv,this.isHidden,this.timerId,this.init()},PopoverWin.prototype.init=function(){var i=this;i.scrollDiv=$('<div class="popover-scrolling"></div>'),i.wrapDiv=$('<div class="popover-wrap"></div>').appendTo(i.scrollDiv),i.bodyDiv=$('<div class="popover-body"></div>').appendTo(i.wrapDiv),i.loadDiv=$('<div class="popover-loader"></div>').appendTo(i.wrapDiv),i.closDiv=$('<div class="popover-close"></div>').appendTo(i.wrapDiv),i.scrollDiv.on("click",function(o){(2===o.eventPhase||$(o.target).is(i.scrollDiv))&&c.close()}),i.closDiv.on("click",function(){c.close()}),i.loadDiv.on("click",function(){c.close()})},PopoverWin.prototype.controlPositionOn=function(){function i(){o.setPosition(),o.timerId=requestAnimationFrame(i)}var o=this;this.timerId=requestAnimationFrame(i),o.setPosition()},PopoverWin.prototype.controlPositionOff=function(){cancelAnimationFrame(this.timerId)},PopoverWin.prototype.enable=function(){this.scrollDiv.removeClass("disable"),this.controlPositionOn()},PopoverWin.prototype.disable=function(){this.controlPositionOff(),this.scrollDiv.addClass("disable")},PopoverWin.prototype.open=function(){var i=this,e=this.options,t=e.width||null,n=e.html||null,l=e.text||null,r=e.elem||null,s=e.clas||null,a=e.ajax||null,c=e.json||null,d=e.data||{},m=e.iframe||null,v=e.onLoad||null,p=e.beforeOpen||null,u=e.afterOpen||null;s&&i.wrapDiv.addClass(s),t&&i.wrapDiv.width(t),n?i.bodyDiv.html(n):l?i.bodyDiv.text(l):r?(i.htmlElem=r=$(r),i.bodyDiv.append(r.contents())):c?(i.loadDiv.show(),$.ajax({url:c,dataType:"json",data:d,success:function(o){var e=Array.prototype.slice.call(arguments,0);i.loadDiv.hide(),o.result&&o.result.html&&i.bodyDiv.html(o.result.html),v&&$.isFunction(v)&&v.apply(i,e)},error:function(o,e,t){i.loadDiv.hide(),i.bodyDiv.html(e)}})):a?(i.loadDiv.show(),$.ajax({url:a,data:d,success:function(o){var e=Array.prototype.slice.call(arguments,0);i.loadDiv.hide(),i.bodyDiv.html(o),v&&$.isFunction(v)&&v.apply(i,e)},error:function(o,e,t){i.loadDiv.hide(),i.bodyDiv.html(e)}})):m&&!function(){function e(){function o(i){var o,e=["scroll","client","offset"],t=0;for(o=e.length-1;o>=0;o--)t=Math.max(t,l.documentElement[e[o]+i]||0,l.body[e[o]+i]||0);return t}function e(){clearTimeout(i.iframeTimerId),i.iframeTimerId=setTimeout(function(){var i=o("Width"),n=o("Height");n>0&&(iframeElem.height=n),!t&&i>0&&(iframeElem.width=i),requestAnimationFrame(e)},1e3)}var n,l;try{n=iframeElem.contentWindow||iframeElem.contentDocument.parentWindow,l=n.document,t&&(t=t-parseInt(i.bodyDiv.css("padding-left"),10)-parseInt(i.bodyDiv.css("padding-left"),10)-parseInt(i.bodyDiv.css("border-left-width"),10)-parseInt(i.bodyDiv.css("border-right-width"),10),iframeElem.width=t),e()}catch(r){i.bodyDiv.html("<h4>"+r.name+"</h4><p>"+r.message+"</p>")}finally{i.loadDiv.hide(),iframeElem.style.visibility="visible",v&&$.isFunction(v)&&v.call(i,iframeElem)}}var n,l;n=["iframe=1"];for(l in d)d.hasOwnProperty(l)&&n.push(l+"="+encodeURI(d[l]));iframeElem=o.createElement("iframe"),iframeElem.frameBorder=0,iframeElem.src=m+"?"+n.join("&"),iframeElem.style.visible="hidden",iframeElem.onload=e,i.bodyDiv.html(iframeElem),i.loadDiv.show()}(),$.isFunction(p)&&p.call(i),i.scrollDiv.show(),i.controlPositionOn(),i.wrapDiv.fadeIn(300,function(){i.isOpened=!0,$.isFunction(u)&&u.call(i)})},PopoverWin.prototype.close=function(){var i=this.options,o=i.beforeClose||null,e=i.afterClose||null;$.isFunction(o)&&o.call(this),this.htmlElem?(this.bodyDiv.contents().appendTo(this.htmlElem),this.htmlElem=!1):this.bodyDiv.empty(),i.iframe&&clearTimeout(this.iframeTimerId),this.controlPositionOff(),this.scrollDiv.hide(),this.scrollDiv.remove(),this.isOpened=!1,$.isFunction(e)&&e.call(this)},PopoverWin.prototype.setPosition=function(i){var o,e,t,n,l=this,r=l.scrollDiv&&l.scrollDiv.length,s=r?0:d.scrollTop(),a=r?0:d.scrollLeft(),c=r?l.scrollDiv.get(0).clientHeight:d.height(),m=r?l.scrollDiv.get(0).clientWidth:d.width();o=l.wrapDiv.outerWidth(!0),e=l.wrapDiv.outerHeight(!0),t=Math.round(s+.5*(c-e)),n=Math.round(a+.5*(m-o)),t=Math.max(s,t),n=Math.max(a,n),l.wrapDiv.css({top:t,left:n})},c}(window,document);!function(){for(var i=0,o=["ms","moz","webkit","o"],e=0;e<o.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[o[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[o[e]+"CancelAnimationFrame"]||window[o[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(o,e){var t=(new Date).getTime(),n=Math.max(0,16-(t-i)),l=window.setTimeout(function(){o(t+n)},n);return i=t+n,l}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(i){clearTimeout(i)})}();
